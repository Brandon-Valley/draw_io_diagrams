<mxfile host="app.diagrams.net" modified="2023-12-02T23:43:10.027Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0" etag="OheYr4wUeFxqlHuxlLUu" version="22.1.5" type="github">
  <diagram name="Page-1" id="pjqLWg9D4QJs4aynukWV">
    <mxGraphModel dx="2537" dy="887" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="_Esm-FiioBOgBzFB0kT--1" value="&lt;font style=&quot;font-size: 72px;&quot;&gt;Variation 1:&lt;/font&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; - Single Time window&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; &amp;nbsp; - All time, last 24 hours, etc&lt;br&gt;&amp;nbsp; - Exact Count not required&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; - As real-time as possible????????&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1150" y="140" width="410" height="220" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--2" value="&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;General Links:&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;- Vids:&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; - https://www.youtube.com/watch?v=RvZbdYvrFeg&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; - https://www.youtube.com/watch?v=XbkjEX-jgj0&amp;amp;list=PLjTveVh7FakKmEXGgI6X-f3aRMWJM-mEm&amp;amp;index=20&amp;amp;t=94s&lt;br&gt;&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="-650" y="1220" width="660" height="140" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--4" value="&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 72px;&quot;&gt;MATH:&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;Will a Redis Sorted-Set work?&lt;/font&gt;&lt;br&gt;TLDR; Barely &lt;br&gt;&lt;br&gt;REDIS RULE OF THUMB:&lt;/div&gt;&lt;div style=&quot;&quot; align=&quot;left&quot;&gt;- OK &amp;lt;25GB&amp;gt; Probably OK &amp;lt;50GB&amp;gt; Probably not OK&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot; align=&quot;left&quot;&gt;&lt;br&gt;How much can I fit in a Redis sorted-set?&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;50GB &quot;max&quot; size&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;~4 billion &quot;max&quot; items&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;How big can each item be? (will this be enough&lt;br&gt;for song ids and # listens?)&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Method - ~ 4bill max items (from redis doc)&lt;br&gt;&lt;br&gt;&lt;blockquote&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;max length of a list is 2&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;&lt;span style=&quot;vertical-align: super;&quot;&gt;32&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt; - 1 elements (4294967295, more than 4 billion of elements per set)&lt;/span&gt;&lt;/font&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;score is 8 bytes (from doc)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;- so 34,359,738,360 bytes just from score&lt;/span&gt;&lt;span style=&quot;font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;font-size: 11pt; font-family: Arial, sans-serif; color: rgb(0, 0, 0); background-color: transparent; font-weight: 400; font-style: normal; font-variant: normal; text-decoration: none; vertical-align: baseline;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Method - Assume 50GB machine:&lt;br&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;div align=&quot;left&quot;&gt;50/4=12.5&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;At max size, each item can only be 12.5 bytes&lt;br&gt;How many songs will we ever have?&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - 200million exist today, so lets say 1 billion&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;How many bytes to represent 1 billion?&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - one byte can represent 256 different chars&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - 1 billion / 256 = 3.9 million ``````````````````&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - 1 billion = 256 ^ num_chars&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - log_256(1 billion) = num_chars (see Napkin Math)&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - num_chars = ~3.4&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;b&gt;&amp;nbsp; - ANSWER: You need 4 chars to represent 1 billion hashes&lt;/b&gt;&lt;br&gt;- So then you could have the other 8 bytes just for # listens&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp; - Which is crazy convenient b/c the score for a Redis Sorted Set&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; is 8 bytes (double-precision float)&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="350" y="40" width="610" height="790" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--5" value="&lt;font style=&quot;font-size: 72px;&quot;&gt;Variation ???: BEST&lt;br&gt;&lt;/font&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; - Multiple fixed time windows&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp; - Last min, 5 min, hour, day, year, all time&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; &amp;nbsp; - All time, last 24 hours, etc&lt;br&gt;&amp;nbsp; - Count not exact but close enough and never an under-estimate (all upper-bound)&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 24px;&quot; align=&quot;left&quot;&gt;&lt;font style=&quot;font-size: 24px;&quot;&gt;&amp;nbsp; - By Genre option??????????????????&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1110" y="1030" width="910" height="240" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="_Esm-FiioBOgBzFB0kT--6" target="_Esm-FiioBOgBzFB0kT--7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--6" value="&lt;b&gt;Browser&lt;/b&gt;" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#60a917;fontColor=#ffffff;strokeColor=#2D7600;" vertex="1" parent="1">
          <mxGeometry x="1020" y="1430" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="_Esm-FiioBOgBzFB0kT--7" target="_Esm-FiioBOgBzFB0kT--9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--7" value="&lt;font color=&quot;#ffffff&quot;&gt;&lt;b&gt;Main Spotify Service&lt;br&gt;&lt;/b&gt;&lt;/font&gt;" style="whiteSpace=wrap;html=1;fillColor=#CC6600;strokeColor=#C73500;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1160" y="1440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--9" value="d" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#CC6600;strokeColor=#C73500;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="1360" y="1455" width="240" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="_Esm-FiioBOgBzFB0kT--13" target="_Esm-FiioBOgBzFB0kT--14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--13" value="&lt;b&gt;Browser&lt;/b&gt;" style="whiteSpace=wrap;html=1;aspect=fixed;fillColor=#6d8764;fontColor=#ffffff;strokeColor=#3A5431;" vertex="1" parent="1">
          <mxGeometry x="1010" y="1600" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="_Esm-FiioBOgBzFB0kT--14" target="_Esm-FiioBOgBzFB0kT--16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--14" value="Main Spotify&lt;br&gt;Service" style="whiteSpace=wrap;html=1;fillColor=#6d8764;strokeColor=#3A5431;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1150" y="1610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="_Esm-FiioBOgBzFB0kT--16" target="_Esm-FiioBOgBzFB0kT--18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--16" value="Stream: Kafka, Kinesis, Event Hub, Confluent" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#76608a;strokeColor=#432D57;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1340" y="1625" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--18" value="Stream Processing&lt;br&gt;Engine&lt;br&gt;Spark" style="whiteSpace=wrap;html=1;fillColor=#a0522d;strokeColor=#6D1F00;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1645" y="1610" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_Esm-FiioBOgBzFB0kT--20" value="&lt;div align=&quot;left&quot;&gt;Shard first by Genre&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Do count-min-sketch on each node&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;Make each batch the min time period the user will see&lt;br&gt;TODO?&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1510" y="1688" width="320" height="70" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
